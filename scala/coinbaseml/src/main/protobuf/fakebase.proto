syntax = "proto3";

import "google/protobuf/duration.proto";
import "google/protobuf/empty.proto";
import "scalapb/scalapb.proto";

option (scalapb.options) = {
  preserve_unknown_fields: false
};

package co.firstorderlabs.fakebase.protos;

service AccountService {
    rpc cancelOrder (CancellationRequest) returns (Cancellation) {
    }
    rpc getMatches (google.protobuf.Empty) returns (MatchEvents) {
    }
    rpc getOrders (google.protobuf.Empty) returns (Orders) {
    }
    rpc getWallets (google.protobuf.Empty) returns (Wallets) {
    }
    rpc placeBuyLimitOrder (BuyLimitOrderRequest) returns (BuyLimitOrder) {
    }
    rpc placeBuyMarketOrder (BuyMarketOrderRequest) returns (BuyMarketOrder) {
    }
    rpc placeSellLimitOrder (SellLimitOrderRequest) returns (SellLimitOrder) {
    }
    rpc placeSellMarketOrder (SellMarketOrderRequest) returns (SellMarketOrder) {
    }
}

enum DoneReason {
    notDone = 0;
    cancelled = 1;
    filled = 2;
}

enum Liquidity {
    global = 0;
    maker = 1;
    taker = 2;
}

enum OrderSide {
    buy = 0;
    sell = 1;
}

enum OrderStatus {
    done = 0;
    open = 1;
    pending = 2;
    received = 3;
    rejected = 4;
}

enum OrderType {
    limit = 0;
    market = 1;
}

enum RejectReason {
    notRejected = 0;
    fundsTooLarge = 1;
    fundsTooSmall = 2;
    insufficientFunds = 3;
    postOnly = 4;
    priceTooLarge = 5;
    priceTooSmall = 6;
    sizeTooLarge = 7;
    sizeTooSmall = 8;
}

message BuyLimitOrderRequest {
    option (scalapb.message).extends = "co.firstorderlabs.fakebase.types.Events.BuyOrderRequest";
    option (scalapb.message).extends = "co.firstorderlabs.fakebase.types.Events.LimitOrderRequest";

    string price = 1 [(scalapb.field).type = "co.firstorderlabs.fakebase.currency.Configs.ProductPrice"];
    string productId = 2 [(scalapb.field).type = "co.firstorderlabs.fakebase.types.Types.ProductId"];
    string size = 3 [(scalapb.field).type = "co.firstorderlabs.fakebase.currency.Configs.ProductPrice.ProductVolume"];
    bool postOnly = 4;
}

message BuyMarketOrderRequest {
    option (scalapb.message).extends = "co.firstorderlabs.fakebase.types.Events.BuyOrderRequest";
    option (scalapb.message).extends = "co.firstorderlabs.fakebase.types.Events.MarketOrderRequest";

    string funds = 1 [(scalapb.field).type = "co.firstorderlabs.fakebase.currency.Configs.ProductPrice.QuoteVolume"];
    string productId = 2 [(scalapb.field).type = "co.firstorderlabs.fakebase.types.Types.ProductId"];
}

message BuyLimitOrder {
    option (scalapb.message).extends = "co.firstorderlabs.fakebase.types.Events.BuyOrderEvent";
    option (scalapb.message).extends = "co.firstorderlabs.fakebase.types.Events.LimitOrderEvent";
    option (scalapb.message).extends = "co.firstorderlabs.fakebase.types.Events.SpecifiesSize";

    string orderId = 1 [(scalapb.field).type = "co.firstorderlabs.fakebase.types.Types.OrderId"];
    OrderStatus orderStatus = 2;
    string price = 3 [(scalapb.field).type = "co.firstorderlabs.fakebase.currency.Configs.ProductPrice"];
    string productId = 4 [(scalapb.field).type = "co.firstorderlabs.fakebase.types.Types.ProductId"];
    OrderSide side = 5;
    string size = 6 [(scalapb.field).type = "co.firstorderlabs.fakebase.currency.Configs.ProductPrice.ProductVolume"];
    string time = 7 [(scalapb.field).type = "co.firstorderlabs.fakebase.types.Types.Datetime"];
    RejectReason rejectReason = 8;
    string requestId = 9 [(scalapb.field).type = "co.firstorderlabs.fakebase.types.Types.OrderRequestId"];
    string doneAt = 10 [(scalapb.field).type = "co.firstorderlabs.fakebase.types.Types.Datetime"];
    DoneReason doneReason = 11;
    MatchEvents matchEvents = 12;
}

message BuyMarketOrder {
    option (scalapb.message).extends = "co.firstorderlabs.fakebase.types.Events.BuyOrderEvent";
    option (scalapb.message).extends = "co.firstorderlabs.fakebase.types.Events.MarketOrderEvent";
    option (scalapb.message).extends = "co.firstorderlabs.fakebase.types.Events.SpecifiesFunds";

    string funds = 1 [(scalapb.field).type = "co.firstorderlabs.fakebase.currency.Configs.ProductPrice.QuoteVolume"];
    string orderId = 2 [(scalapb.field).type = "co.firstorderlabs.fakebase.types.Types.OrderId"];
    OrderStatus orderStatus = 3;
    string productId = 4 [(scalapb.field).type = "co.firstorderlabs.fakebase.types.Types.ProductId"];
    OrderSide side = 5;
    string time = 6 [(scalapb.field).type = "co.firstorderlabs.fakebase.types.Types.Datetime"];
    RejectReason rejectReason = 7;
    string requestId = 8 [(scalapb.field).type = "co.firstorderlabs.fakebase.types.Types.OrderRequestId"];
    string doneAt = 9 [(scalapb.field).type = "co.firstorderlabs.fakebase.types.Types.Datetime"];
    DoneReason doneReason = 10;
    MatchEvents matchEvents = 12;
}

message CancellationRequest {
    string orderId = 1 [(scalapb.field).type = "co.firstorderlabs.fakebase.types.Types.OrderId"];
}

message Cancellation {
    option (scalapb.message).extends = "co.firstorderlabs.fakebase.types.Events.Event";

    string orderId = 1 [(scalapb.field).type = "co.firstorderlabs.fakebase.types.Types.OrderId"];
    string price = 2 [(scalapb.field).type = "co.firstorderlabs.fakebase.currency.Configs.ProductPrice"];
    string productId = 3 [(scalapb.field).type = "co.firstorderlabs.fakebase.types.Types.ProductId"];
    OrderSide side = 4;
    string remainingSize = 6 [(scalapb.field).type = "co.firstorderlabs.fakebase.currency.Configs.ProductPrice.ProductVolume"];
    string time = 7 [(scalapb.field).type = "co.firstorderlabs.fakebase.types.Types.Datetime"];
}

message Order {
    oneof sealed_value {
        BuyLimitOrder buyLimitOrder = 1;
        BuyMarketOrder buyMarketOrder = 2;
        SellLimitOrder sellLimitOrder = 3;
        SellMarketOrder sellMarketOrder = 4;
    }
}

message Orders {
    map<string, Order> orders=1;
}

message Match {
    option (scalapb.message).extends = "co.firstorderlabs.fakebase.types.Events.MatchEvent";

    Liquidity liquidity = 1;
    string makerOrderId = 2 [(scalapb.field).type = "co.firstorderlabs.fakebase.types.Types.OrderId"];
    string price = 3 [(scalapb.field).type = "co.firstorderlabs.fakebase.currency.Configs.ProductPrice"];
    string productId = 4 [(scalapb.field).type = "co.firstorderlabs.fakebase.types.Types.ProductId"];
    OrderSide side = 5;
    string size = 6 [(scalapb.field).type = "co.firstorderlabs.fakebase.currency.Configs.ProductPrice.ProductVolume"];
    string takerOrderId = 7 [(scalapb.field).type = "co.firstorderlabs.fakebase.types.Types.OrderId"];
    string time = 8 [(scalapb.field).type = "co.firstorderlabs.fakebase.types.Types.Datetime"];
    int64 tradeId = 9 [(scalapb.field).type = "co.firstorderlabs.fakebase.types.Types.TradeId"];
    Order makerOrder = 10;
    Order takerOrder = 11;
}

message MatchEvents {
    repeated Match matchEvents = 1;
}

message SellLimitOrderRequest {
    option (scalapb.message).extends = "co.firstorderlabs.fakebase.types.Events.LimitOrderRequest";
    option (scalapb.message).extends = "co.firstorderlabs.fakebase.types.Events.SellOrderRequest";

    string price = 1 [(scalapb.field).type = "co.firstorderlabs.fakebase.currency.Configs.ProductPrice"];
    string productId = 2 [(scalapb.field).type = "co.firstorderlabs.fakebase.types.Types.ProductId"];
    string size = 3 [(scalapb.field).type = "co.firstorderlabs.fakebase.currency.Configs.ProductPrice.ProductVolume"];
    bool postOnly = 4;
}

message SellMarketOrderRequest {
    option (scalapb.message).extends = "co.firstorderlabs.fakebase.types.Events.MarketOrderRequest";
    option (scalapb.message).extends = "co.firstorderlabs.fakebase.types.Events.SellOrderRequest";

    string productId = 1 [(scalapb.field).type = "co.firstorderlabs.fakebase.types.Types.ProductId"];
    string size = 2 [(scalapb.field).type = "co.firstorderlabs.fakebase.currency.Configs.ProductPrice.ProductVolume"];
}

message SellLimitOrder {
    option (scalapb.message).extends = "co.firstorderlabs.fakebase.types.Events.SellOrderEvent";
    option (scalapb.message).extends = "co.firstorderlabs.fakebase.types.Events.LimitOrderEvent";
    option (scalapb.message).extends = "co.firstorderlabs.fakebase.types.Events.SpecifiesSize";

    string orderId = 1 [(scalapb.field).type = "co.firstorderlabs.fakebase.types.Types.OrderId"];
    OrderStatus orderStatus = 2;
    string price = 3 [(scalapb.field).type = "co.firstorderlabs.fakebase.currency.Configs.ProductPrice"];
    string productId = 4 [(scalapb.field).type = "co.firstorderlabs.fakebase.types.Types.ProductId"];
    OrderSide side = 5;
    string size = 6 [(scalapb.field).type = "co.firstorderlabs.fakebase.currency.Configs.ProductPrice.ProductVolume"];
    string time = 7 [(scalapb.field).type = "co.firstorderlabs.fakebase.types.Types.Datetime"];
    RejectReason rejectReason = 8;
    string requestId = 9 [(scalapb.field).type = "co.firstorderlabs.fakebase.types.Types.OrderRequestId"];
    string doneAt = 10 [(scalapb.field).type = "co.firstorderlabs.fakebase.types.Types.Datetime"];
    DoneReason doneReason = 11;
    MatchEvents matchEvents = 12;
}

message SellMarketOrder {
    option (scalapb.message).extends = "co.firstorderlabs.fakebase.types.Events.SellOrderEvent";
    option (scalapb.message).extends = "co.firstorderlabs.fakebase.types.Events.MarketOrderEvent";
    option (scalapb.message).extends = "co.firstorderlabs.fakebase.types.Events.SpecifiesSize";

    string orderId = 1 [(scalapb.field).type = "co.firstorderlabs.fakebase.types.Types.OrderId"];
    OrderStatus orderStatus = 2;
    string productId = 3 [(scalapb.field).type = "co.firstorderlabs.fakebase.types.Types.ProductId"];
    OrderSide side = 4;
    string size = 5 [(scalapb.field).type = "co.firstorderlabs.fakebase.currency.Configs.ProductPrice.ProductVolume"];
    string time = 6 [(scalapb.field).type = "co.firstorderlabs.fakebase.types.Types.Datetime"];
    RejectReason rejectReason = 7;
    string requestId = 8 [(scalapb.field).type = "co.firstorderlabs.fakebase.types.Types.OrderRequestId"];
    string doneAt = 9 [(scalapb.field).type = "co.firstorderlabs.fakebase.types.Types.Datetime"];
    DoneReason doneReason = 10;
    MatchEvents matchEvents = 12;
}

message Wallet {
    string id = 1;
    string balance = 2;
    string holds = 3;
}

message Wallets {
    map<string, Wallet> wallets = 1;
}

service ExchangeService {
    rpc checkpoint (google.protobuf.Empty) returns (google.protobuf.Empty){
    }
    rpc getExchangeInfo (google.protobuf.Empty) returns (ExchangeInfo) {
    }
    rpc getMatches (google.protobuf.Empty) returns (MatchEvents) {
    }
    rpc getOrderBooks (OrderBooksRequest) returns (OrderBooks) {
    }
    rpc reset (google.protobuf.Empty) returns (ExchangeInfo) {
    }
    rpc start (SimulationStartRequest) returns (ExchangeInfo) {
    }
    rpc step (StepRequest) returns (ExchangeInfo) {
    }
    rpc stop (google.protobuf.Empty) returns (google.protobuf.Empty) {
    }
}

message ExchangeInfo {
    string intervalStartTime = 1 [(scalapb.field).type = "co.firstorderlabs.fakebase.types.Types.Datetime"];
    string intervalEndTime = 2 [(scalapb.field).type = "co.firstorderlabs.fakebase.types.Types.Datetime"];
}

message OrderBooksRequest {
    int32 orderBookDepth = 1;
}

message OrderBooks {
    map<string, string> buyOrderBook = 1;
    map<string, string> sellOrderBook = 2;
}

message SimulationStartRequest {
    string startTime = 1 [(scalapb.field).type = "co.firstorderlabs.fakebase.types.Types.Datetime"];
    string endTime = 2 [(scalapb.field).type = "co.firstorderlabs.fakebase.types.Types.Datetime"];
    google.protobuf.Duration timeDelta = 3;
    int32 numWarmUpSteps = 4;
    string initialProductFunds = 5 [(scalapb.field).type = "co.firstorderlabs.fakebase.currency.Configs.ProductPrice.ProductVolume"];
    string initialQuoteFunds = 6 [(scalapb.field).type = "co.firstorderlabs.fakebase.currency.Configs.ProductPrice.QuoteVolume"];
}

message StepRequest {
    repeated Order insertOrders = 1;
    repeated Cancellation insertCancellations = 2;
}